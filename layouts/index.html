{{ define "main" }}
<h1>{{ .Title }}</h1>
<div class="intro-text">
    {{ .Content }}
</div>

<h2 class="section-heading">Writeups</h2>

<!-- Tag Filter -->
<div class="tag-filters">
    <button class="filter-tag active" data-tag="all">All</button>
    {{ $ctfCategories := slice "pwn" "web" "reverse" "crypto" "forensics" "misc" "network" "steganography" "osint" }}
    {{ $tags := slice }}
    {{ range (where .Site.RegularPages "Section" "writeups") }}
        {{ with .Params.tags }}
            {{ $tags = $tags | append . }}
        {{ end }}
    {{ end }}
    {{ range ($tags | uniq) }}
        {{ $lowerTag := lower . }}
        {{ if in $ctfCategories $lowerTag }}
    <button class="filter-tag" data-tag="{{ . }}">{{ . }}</button>
        {{ end }}
    {{ end }}
</div>

<div class="writeups-list">
    {{ range (where .Site.RegularPages "Section" "writeups").ByDate.Reverse }}
    <div class="writeup-card" data-tags="{{ if .Params.tags }}{{ delimit .Params.tags "," }}{{ end }}">
        <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
        <div class="writeup-meta">
            <span>{{ .Date.Format "Jan 2, 2006" }}</span>
            {{ if .Params.tags }}
            <span>â€¢</span>
            <div class="tags">
                {{ range .Params.tags }}
                <span class="tag" data-tag="{{ . }}">{{ . }}</span>
                {{ end }}
            </div>
            {{ end }}
        </div>
    </div>
    {{ end }}
</div>

<script>
// Tag filtering
const filterTags = document.querySelectorAll('.filter-tag');
const writeupCards = document.querySelectorAll('.writeup-card');
const cardTags = document.querySelectorAll('.tag');

function filterWriteups(selectedTag) {
    writeupCards.forEach(card => {
        const cardTagsAttr = card.getAttribute('data-tags');
        const tags = cardTagsAttr ? cardTagsAttr.split(',') : [];

        if (selectedTag === 'all' || tags.includes(selectedTag)) {
            card.style.display = 'flex';
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 10);
        } else {
            card.style.opacity = '0';
            card.style.transform = 'translateY(10px)';
            setTimeout(() => {
                card.style.display = 'none';
            }, 200);
        }
    });
}

// Filter buttons
filterTags.forEach(button => {
    button.addEventListener('click', () => {
        const tag = button.getAttribute('data-tag');

        // Update active state
        filterTags.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        // Filter cards
        filterWriteups(tag);
    });
});

// Clickable tags in cards
cardTags.forEach(tag => {
    tag.style.cursor = 'pointer';
    tag.addEventListener('click', (e) => {
        e.preventDefault();
        const tagName = tag.getAttribute('data-tag');

        // Update filter buttons
        filterTags.forEach(btn => {
            if (btn.getAttribute('data-tag') === tagName) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });

        // Filter cards
        filterWriteups(tagName);

        // Scroll to top of list
        document.querySelector('.tag-filters').scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
});
</script>
{{ end }}
